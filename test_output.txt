
   FAIL  Tests\Feature\SubscriptionTest
  ✓ user can get subscription                                                                                                                                      1.15s  
  ✓ anyone can get plans                                                                                                                                           0.02s  
  ⨯ user can upgrade to pro                                                                                                                                        0.04s  
  ⨯ user can downgrade to free                                                                                                                                     0.02s  
  ⨯ user can cancel subscription                                                                                                                                   0.02s  
  ⨯ user can reactivate subscription                                                                                                                               0.02s  
  ✓ user can get subscription invoices                                                                                                                             0.02s  
  ✓ user can get usage statistics                                                                                                                                  0.02s  
  ✓ user cannot upgrade to same plan                                                                                                                               0.01s  
  ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\SubscriptionTest > user can upgrade to pro                                                                                                       
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_2_App_Services_StripeService::updateSubscription(): Return value must be of type Stripe\Subscription, stdClass returned in C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\mockery\mockery\library\Mockery\Loader\EvalLoader.php(30) : eval()'d code:1073
Stack trace:
#0 C:\Users\DELL\Documents\mes-projets\ria-sas-api\app\Http\Controllers\SubscriptionController.php(89): Mockery_2_App_Services_StripeService->updateSubscription(Object(App\Models\User), 'pro')
#1 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(46): App\Http\Controllers\SubscriptionController->upgrade(Object(App\Http\Requests\SubscriptionRequest))
#2 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(265): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\SubscriptionController), 'upgrade')
#3 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(211): Illuminate\Routing\Route->runController()
#4 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(822): Illuminate\Routing\Route->run()
#5 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#6 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#7 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#8 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(166): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#9 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(129): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#10 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(90): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'api', Object(Closure))
#11 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'api')
#12 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(63): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#14 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->Laravel\Sanctum\Http\Middleware\{closure}(Object(Illuminate\Http\Request))
#16 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(25): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->handle(Object(Illuminate\Http\Request), Object(Closure))
#19 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#20 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#21 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#22 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#23 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#24 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#25 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#26 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#32 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#33 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#34 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#35 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#36 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#37 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#38 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#39 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#40 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#41 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#42 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#43 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#44 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#45 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#46 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#47 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#48 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/subscripti...', Array, Array, Array, Array, '{"planId":"pro"...')
#49 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/subscripti...', Array, Array, 0)
#50 C:\Users\DELL\Documents\mes-projets\ria-sas-api\tests\Feature\SubscriptionTest.php(66): Illuminate\Foundation\Testing\TestCase->postJson('/api/subscripti...', Array, Array)
#51 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(1332): Tests\Feature\SubscriptionTest->test_user_can_upgrade_to_pro()
#52 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#53 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(99): PHPUnit\Framework\TestCase->runBare()
#54 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(359): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\SubscriptionTest))
#55 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestSuite.php(374): PHPUnit\Framework\TestCase->run()
#56 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#57 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\Application.php(229): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#58 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\src\Kernel.php(103): PHPUnit\TextUI\Application->run(Array)
#59 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(184): Pest\Kernel->handle(Array, Array)
#60 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(192): {closure}()
#61 {main}

----------------------------------------------------------------------------------

Mockery_2_App_Services_StripeService::updateSubscription(): Return value must be of type Stripe\Subscription, stdClass returned

  at tests\Feature\SubscriptionTest.php:73
     69▕         ], [
     70▕             'Authorization' => "Bearer $token",
     71▕         ]);
     72▕ 
  ➜  73▕         $response->assertStatus(200)
     74▕             ->assertJsonPath('plan', 'pro');
     75▕     }
     76▕ 
     77▕     /**

  ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\SubscriptionTest > user can downgrade to free                                                                                                    
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_2_App_Services_StripeService::updateSubscription(): Return value must be of type Stripe\Subscription, stdClass returned in C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\mockery\mockery\library\Mockery\Loader\EvalLoader.php(30) : eval()'d code:1073
Stack trace:
#0 C:\Users\DELL\Documents\mes-projets\ria-sas-api\app\Http\Controllers\SubscriptionController.php(125): Mockery_2_App_Services_StripeService->updateSubscription(Object(App\Models\User), 'free')
#1 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(46): App\Http\Controllers\SubscriptionController->downgrade(Object(App\Http\Requests\SubscriptionRequest))
#2 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(265): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\SubscriptionController), 'downgrade')
#3 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(211): Illuminate\Routing\Route->runController()
#4 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(822): Illuminate\Routing\Route->run()
#5 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#6 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#7 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#8 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(166): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#9 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(129): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#10 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(90): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'api', Object(Closure))
#11 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'api')
#12 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(63): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#14 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->Laravel\Sanctum\Http\Middleware\{closure}(Object(Illuminate\Http\Request))
#16 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(25): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->handle(Object(Illuminate\Http\Request), Object(Closure))
#19 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#20 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#21 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#22 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#23 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#24 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#25 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#26 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#32 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#33 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#34 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#35 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#36 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#37 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#38 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#39 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#40 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#41 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#42 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#43 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#44 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#45 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#46 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#47 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#48 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/subscripti...', Array, Array, Array, Array, '{"planId":"free...')
#49 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/subscripti...', Array, Array, 0)
#50 C:\Users\DELL\Documents\mes-projets\ria-sas-api\tests\Feature\SubscriptionTest.php(93): Illuminate\Foundation\Testing\TestCase->postJson('/api/subscripti...', Array, Array)
#51 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(1332): Tests\Feature\SubscriptionTest->test_user_can_downgrade_to_free()
#52 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#53 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(99): PHPUnit\Framework\TestCase->runBare()
#54 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(359): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\SubscriptionTest))
#55 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestSuite.php(374): PHPUnit\Framework\TestCase->run()
#56 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#57 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\Application.php(229): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#58 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\src\Kernel.php(103): PHPUnit\TextUI\Application->run(Array)
#59 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(184): Pest\Kernel->handle(Array, Array)
#60 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(192): {closure}()
#61 {main}

----------------------------------------------------------------------------------

Mockery_2_App_Services_StripeService::updateSubscription(): Return value must be of type Stripe\Subscription, stdClass returned

  at tests\Feature\SubscriptionTest.php:99
     95▕         ], [
     96▕             'Authorization' => "Bearer $token",
     97▕         ]);
     98▕ 
  ➜  99▕         $response->assertStatus(200)
    100▕             ->assertJsonPath('plan', 'free');
    101▕     }
    102▕ 
    103▕     /**

  ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\SubscriptionTest > user can cancel subscription                                                                                                  
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_2_App_Services_StripeService::cancelSubscription(): Return value must be of type ?Stripe\Subscription, stdClass returned in C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\mockery\mockery\library\Mockery\Loader\EvalLoader.php(30) : eval()'d code:1080
Stack trace:
#0 C:\Users\DELL\Documents\mes-projets\ria-sas-api\app\Http\Controllers\SubscriptionController.php(160): Mockery_2_App_Services_StripeService->cancelSubscription(Object(App\Models\User), false)
#1 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(46): App\Http\Controllers\SubscriptionController->cancel(Object(App\Http\Requests\SubscriptionRequest))
#2 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(265): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\SubscriptionController), 'cancel')
#3 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(211): Illuminate\Routing\Route->runController()
#4 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(822): Illuminate\Routing\Route->run()
#5 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#6 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#7 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#8 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(166): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#9 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(129): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#10 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(90): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'api', Object(Closure))
#11 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'api')
#12 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(63): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#14 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->Laravel\Sanctum\Http\Middleware\{closure}(Object(Illuminate\Http\Request))
#16 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(25): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->handle(Object(Illuminate\Http\Request), Object(Closure))
#19 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#20 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#21 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#22 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#23 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#24 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#25 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#26 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#32 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#33 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#34 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#35 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#36 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#37 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#38 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#39 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#40 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#41 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#42 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#43 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#44 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#45 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#46 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#47 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#48 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/subscripti...', Array, Array, Array, Array, '{"reason":"Too ...')
#49 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/subscripti...', Array, Array, 0)
#50 C:\Users\DELL\Documents\mes-projets\ria-sas-api\tests\Feature\SubscriptionTest.php(119): Illuminate\Foundation\Testing\TestCase->postJson('/api/subscripti...', Array, Array)
#51 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(1332): Tests\Feature\SubscriptionTest->test_user_can_cancel_subscription()
#52 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#53 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(99): PHPUnit\Framework\TestCase->runBare()
#54 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(359): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\SubscriptionTest))
#55 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestSuite.php(374): PHPUnit\Framework\TestCase->run()
#56 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#57 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\Application.php(229): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#58 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\src\Kernel.php(103): PHPUnit\TextUI\Application->run(Array)
#59 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(184): Pest\Kernel->handle(Array, Array)
#60 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(192): {closure}()
#61 {main}

----------------------------------------------------------------------------------

Mockery_2_App_Services_StripeService::cancelSubscription(): Return value must be of type ?Stripe\Subscription, stdClass returned

  at tests\Feature\SubscriptionTest.php:126
    122▕         ], [
    123▕             'Authorization' => "Bearer $token",
    124▕         ]);
    125▕ 
  ➜ 126▕         $response->assertStatus(200);
    127▕     }
    128▕ 
    129▕     /**
    130▕      * Test reactivate subscription within 30 days.

  ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\SubscriptionTest > user can reactivate subscription                                                                                              
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_2_App_Services_StripeService::reactivateSubscription(): Return value must be of type Stripe\Subscription, stdClass returned in C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\mockery\mockery\library\Mockery\Loader\EvalLoader.php(30) : eval()'d code:1087
Stack trace:
#0 C:\Users\DELL\Documents\mes-projets\ria-sas-api\app\Http\Controllers\SubscriptionController.php(192): Mockery_2_App_Services_StripeService->reactivateSubscription(Object(App\Models\User))
#1 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(46): App\Http\Controllers\SubscriptionController->reactivate(Object(Illuminate\Http\Request))
#2 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(265): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\SubscriptionController), 'reactivate')
#3 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Route.php(211): Illuminate\Routing\Route->runController()
#4 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(822): Illuminate\Routing\Route->run()
#5 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#6 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#7 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#8 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(166): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#9 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(129): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#10 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(90): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'api', Object(Closure))
#11 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'api')
#12 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(63): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#14 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->Laravel\Sanctum\Http\Middleware\{closure}(Object(Illuminate\Http\Request))
#16 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\sanctum\src\Http\Middleware\EnsureFrontendRequestsAreStateful.php(25): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful->handle(Object(Illuminate\Http\Request), Object(Closure))
#19 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#20 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#21 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#22 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#23 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Routing\Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#24 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#25 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#26 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#32 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#33 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#34 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#35 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#36 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#37 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#38 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#39 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#40 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#41 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#42 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#43 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#44 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#45 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#46 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#47 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#48 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/subscripti...', Array, Array, Array, Array, '[]')
#49 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/subscripti...', Array, Array, 0)
#50 C:\Users\DELL\Documents\mes-projets\ria-sas-api\tests\Feature\SubscriptionTest.php(146): Illuminate\Foundation\Testing\TestCase->postJson('/api/subscripti...', Array, Array)
#51 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(1332): Tests\Feature\SubscriptionTest->test_user_can_reactivate_subscription()
#52 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#53 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(99): PHPUnit\Framework\TestCase->runBare()
#54 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestCase.php(359): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\SubscriptionTest))
#55 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\Framework\TestSuite.php(374): PHPUnit\Framework\TestCase->run()
#56 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#57 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\phpunit\phpunit\src\TextUI\Application.php(229): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#58 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\src\Kernel.php(103): PHPUnit\TextUI\Application->run(Array)
#59 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(184): Pest\Kernel->handle(Array, Array)
#60 C:\Users\DELL\Documents\mes-projets\ria-sas-api\vendor\pestphp\pest\bin\pest(192): {closure}()
#61 {main}

----------------------------------------------------------------------------------

Mockery_2_App_Services_StripeService::reactivateSubscription(): Return value must be of type Stripe\Subscription, stdClass returned

  at tests\Feature\SubscriptionTest.php:150
    146▕         $response = $this->postJson('/api/subscription/reactivate', [], [
    147▕             'Authorization' => "Bearer $token",
    148▕         ]);
    149▕ 
  ➜ 150▕         $response->assertStatus(200)
    151▕             ->assertJsonPath('status', 'active');
    152▕     }
    153▕ 
    154▕     /**


  Tests:    4 failed, 5 passed (23 assertions)
  Duration: 1.45s

